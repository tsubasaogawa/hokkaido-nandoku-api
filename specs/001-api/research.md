# Research: 北海道の難読地名を取得するAPI

## 決定事項

### プログラミング言語
- **決定**: Go (1.22 or later)
- **理由**:
    - シングルバイナリとしてデプロイが容易であり、コンテナ化との相性が良い。
    - 標準ライブラリが充実しており、今回の要件（HTTPサーバー、CSV読み込み）であれば外部ライブラリへの依存を最小限に抑えられる。
    - AWS Lambdaのカスタムランタイムやコンテナイメージとしてサポートされている。
- **代替案**:
    - **Python (FastAPI)**: Lambdaのランタイムとしてサポートされているが、依存関係の管理がGoより複雑になる可能性がある。
    - **Node.js (Express)**: 同様にLambdaでサポートされているが、静的型付けの恩恵を受けるにはTypeScriptの導入が必要。

### フレームワーク
- **決定**: なし（標準ライブラリのみ）
- **理由**:
    - `net/http` パッケージでAPI Gatewayからのリクエストを処理するハンドラを実装可能。
    - `encoding/csv` パッケージでCSVファイルの読み込みが可能。
    - 外部フレームワークを導入するほどの複雑性は不要。

### データストレージ
- **決定**: アプリケーションに同梱されたCSVファイル
- **理由**:
    - 仕様で明確に定義されている。
    - データベースを別途用意する必要がなく、アプリケーションのポータビリティが高まる。
    - 地名データが静的であり、頻繁な更新が想定されないため、CSVで十分。

### インフラストラクチャ
- **決定**: AWS Lambda + Amazon API Gateway
- **理由**:
    - サーバーレスアーキテクチャにより、インフラ管理のオーバーヘッドを削減できる。
    - リクエスト数に応じたスケーリングが自動で行われる。
    - API Gatewayを利用して、レートリミット、ロギング、モニタリングなどのAPI管理機能を容易に導入できる。
    - コンテナイメージを利用することで、ローカルでの開発・テスト環境と本番環境の差異を最小限に抑えられる。
- **代替案**:
    - **Amazon EC2 + Nginx**: より柔軟な構成が可能だが、サーバーのプロビジョニング、スケーリング、メンテナンスの管理が必要になる。
    - **AWS Fargate**: コンテナオーケストレーションサービスだが、常時稼働させる必要がない今回のユースケースではLambdaの方がコスト効率が良い。

### Infrastructure as Code
- **決定**: Terraform (with `terraform-aws-modules/lambda`)
- **理由**:
    - AWSリソース（API Gateway, Lambda, ECR）をコードで宣言的に管理できるため、再現性と一貫性が向上する。
    - `terraform-aws-modules/lambda` を利用することで、コンテナイメージのビルド、ECRリポジトリの作成、Lambdaへのデプロイまでを `terraform apply` 一発で実行でき、CI/CDパイプラインの構築が大幅に簡素化される。
    - `terraform plan` により、適用前に変更内容を確認できるため、安全なインフラ変更が可能。
- **代替案**:
    - **AWS CDK**: プログラミング言語でインフラを定義できるが、学習コストがTerraformより高い可能性がある。
    - **AWS CloudFormation**: AWSネイティブのIaCツールだが、YAML/JSONでの記述が冗長になりがち。

### テスト
- **決定**: 標準の `testing` パッケージ
- **理由**:
    - Goの標準ライブラリに組み込まれており、追加の依存なしでユニットテストが記述可能。
    - Lambdaハンドラ関数を直接テストすることができる。

### パフォーマンス目標
- **決定**: p99で200ms未満のレスポンスタイム
- **理由**:
    - Lambdaのコールドスタートを考慮しても、データがメモリ上にロードされるため高速なレスポンスが期待できる。

### 制約
- **決定**: グローバルで毎秒1リクエストのレートリミット
- **理由**:
    - 仕様で明確に定義されている。API Gatewayの従量課金モデルにおいて、コストを予測可能な範囲に抑えるためにも有効。
